<link rel="stylesheet" href="/editor.md/css/editormd.min.css" />
<div class="input-group">
    <!-- <button class="btn btn-outline-secondary" type="button" id="button-addon1">{{.Dictionary.Editor.BtnImage}}</button> -->
    <!-- <span class="input-group-text" id="basic-addon1">{{.Dto.Image}}</span> -->
    <input id="title" type="text" class="form-control" placeholder="{{.Dictionary.Editor.TitlePlaceholder}}" aria-label="Recipient's username" aria-describedby="basic-addon2" value="{{.Dto.Title}}">
    <button id="save-btn" class="btn btn-outline-secondary" type="button" style="min-width: 120px;">{{.Dictionary.Editor.BtnSave}}</button>
</div>

<div id="editor">
    <!-- Tips: Editor.md can auto append a `<textarea>` tag -->
    <!-- TODO: Add save and autosave -->
    <textarea style="display:none;">{{.Dto.Markdown}}</textarea>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="/editor.md/editormd.min.js"></script>
<script src="/editor.js"></script>
<script type="text/javascript">
    var editor
    $(function() {
        editor = editormd("editor", {
            width: "100%",
            height: "1000px",
            delay: 10,
            // markdown: "xxxx",     // dynamic set Markdown text
            path : "/editor.md/lib/",  // Autoload modules mode, codemirror, marked... dependents libs path
            // theme : "dark",
            // previewTheme : "dark",
            // editorTheme : "pastel-on-dark",
            codeFold : true,
            // syncScrolling : false,
            saveHTMLToTextarea : true,    // 保存 HTML 到 Textarea
            searchReplace : true,
            // watch : false,                // 关闭实时预览
            htmlDecode : "style,script,iframe|on*",            // 开启 HTML 标签解析，为了安全性，默认不开启    
            // toolbar  : false,             //关闭工具栏
            // previewCodeHighlight : false, // 关闭预览 HTML 的代码块高亮，默认开启
            emoji : true,
            taskList : true,
            tocm            : true,         // Using [TOCM]
            tex : true,                   // 开启科学公式TeX语言支持，默认关闭
            // flowChart : true,             // 开启流程图支持，默认关闭
            // sequenceDiagram : true,       // 开启时序/序列图支持，默认关闭,
            // dialogLockScreen : false,   // 设置弹出层对话框不锁屏，全局通用，默认为true
            // dialogShowMask : false,     // 设置弹出层对话框显示透明遮罩层，全局通用，默认为true
            // dialogDraggable : false,    // 设置弹出层对话框不可拖动，全局通用，默认为true
            // dialogMaskOpacity : 0.4,    // 设置透明遮罩层的透明度，全局通用，默认值为0.1
            // dialogMaskBgColor : "#000", // 设置透明遮罩层的背景颜色，全局通用，默认为#fff
            imageUpload : true,
            imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL : "/api/post/image",
            onload : function() {
                console.log('onload', this);
                //this.fullscreen();
                //this.unwatch();
                //this.watch().fullscreen();

                //this.setMarkdown("#PHP");
                //this.width("100%");
                //this.height(480);
                //this.resize("100%", 640);
            },
            lang : {
                name : "en",
                description                     : "{{.Dictionary.Editor.Description}}",
                tocTitle                        : "{{.Dictionary.Editor.TocTitle}}",
                toolbar : {
                    undo                        : "{{.Dictionary.Editor.ToolbarUndo}}",
                    redo                        : "{{.Dictionary.Editor.ToolbarRedo}}",
                    bold                        : "{{.Dictionary.Editor.ToolbarBold}}",
                    del                         : "{{.Dictionary.Editor.ToolbarDel}}",
                    italic                      : "{{.Dictionary.Editor.ToolbarItalic}}",
                    quote                       : "{{.Dictionary.Editor.ToolbarQuote}}",
                    ucwords                     : "{{.Dictionary.Editor.ToolbarUcwords}}",
                    uppercase                   : "{{.Dictionary.Editor.ToolbarUppercase}}",
                    lowercase                   : "{{.Dictionary.Editor.ToolbarLowercase}}",
                    h1                          : "{{.Dictionary.Editor.ToolbarH1}}",
                    h2                          : "{{.Dictionary.Editor.ToolbarH2}}",
                    h3                          : "{{.Dictionary.Editor.ToolbarH3}}",
                    h4                          : "{{.Dictionary.Editor.ToolbarH4}}",
                    h5                          : "{{.Dictionary.Editor.ToolbarH5}}",
                    h6                          : "{{.Dictionary.Editor.ToolbarH6}}",
                    "list-ul"                   : "{{.Dictionary.Editor.ToolbarListUl}}",
                    "list-ol"                   : "{{.Dictionary.Editor.ToolbarListOl}}",
                    hr                          : "{{.Dictionary.Editor.ToolbarHr}}",
                    link                        : "{{.Dictionary.Editor.ToolbarLink}}",
                    "reference-link"            : "{{.Dictionary.Editor.ToolbarReferenceLink}}",
                    image                       : "{{.Dictionary.Editor.ToolbarImage}}",
                    code                        : "{{.Dictionary.Editor.ToolbarCode}}",
                    "preformatted-text"         : "{{.Dictionary.Editor.ToolbarPreformattedText}}",
                    "code-block"                : "{{.Dictionary.Editor.ToolbarCodeBlock}}",
                    table                       : "{{.Dictionary.Editor.ToolbarTable}}",
                    datetime                    : "{{.Dictionary.Editor.ToolbarDatetime}}",
                    emoji                       : "{{.Dictionary.Editor.ToolbarEmoji}}",
                    "html-entities"             : "{{.Dictionary.Editor.ToolbarHtmlEntities}}",
                    pagebreak                   : "{{.Dictionary.Editor.ToolbarPagebreak}}",
                    watch                       : "{{.Dictionary.Editor.ToolbarWatch}}",
                    unwatch                     : "{{.Dictionary.Editor.ToolbarUnwatch}}",
                    preview                     : "{{.Dictionary.Editor.ToolbarPreview}}",
                    fullscreen                  : "{{.Dictionary.Editor.ToolbarFullscreen}}",
                    clear                       : "{{.Dictionary.Editor.ToolbarClear}}",
                    search                      : "{{.Dictionary.Editor.ToolbarSearch}}",
                    help                        : "{{.Dictionary.Editor.ToolbarHelp}}",
                    info                        : "{{.Dictionary.Editor.ToolbarInfo}}",
                },
                buttons : {
                    enter                       : "{{.Dictionary.Editor.ButtonsEnter}}",
                    cancel                      : "{{.Dictionary.Editor.ButtonsCancel}}",
                    close                       : "{{.Dictionary.Editor.ButtonsClose}}",
                },
                dialog : {
                    link : {
                        title                   : "{{.Dictionary.Editor.DialogLinkTitle}}",
                        url                     : "{{.Dictionary.Editor.DialogLinkUrl}}",
                        urlTitle                : "{{.Dictionary.Editor.DialogLinkUrlTitle}}",
                        urlEmpty                : "{{.Dictionary.Editor.DialogLinkUrlEmpty}}",
                    },
                    referenceLink : {
                        title                   : "{{.Dictionary.Editor.DialogReferenceLinkTitle}}",
                        name                    : "{{.Dictionary.Editor.DialogReferenceLinkName}}",
                        url                     : "{{.Dictionary.Editor.DialogReferenceLinkUrl}}",
                        urlId                   : "{{.Dictionary.Editor.DialogReferenceLinkUrlId}}",
                        urlTitle                : "{{.Dictionary.Editor.DialogReferenceLinkUrlTitle}}",
                        nameEmpty               : "{{.Dictionary.Editor.DialogReferenceLinkNameEmpty}}",
                        idEmpty                 : "{{.Dictionary.Editor.DialogReferenceLinkIdEmpty}}",
                        urlEmpty                : "{{.Dictionary.Editor.DialogReferenceLinkUrlEmpty}}",
                    },
                    image : {
                        title                   : "{{.Dictionary.Editor.DialogImageTitle}}",
                        url                     : "{{.Dictionary.Editor.DialogImageUrl}}",
                        link                    : "{{.Dictionary.Editor.DialogImageLink}}",
                        alt                     : "{{.Dictionary.Editor.DialogImageAlt}}",
                        uploadButton            : "{{.Dictionary.Editor.DialogImageUploadButton}}",
                        imageURLEmpty           : "{{.Dictionary.Editor.DialogImageImageURLEmpty}}",
                        uploadFileEmpty         : "{{.Dictionary.Editor.DialogImageUploadFileEmpty}}",
                        formatNotAllowed        : "{{.Dictionary.Editor.DialogImageFormatNotAllowed}}",
                    },
                    preformattedText : {
                        title                   : "{{.Dictionary.Editor.DialogPreformattedTextTitle}}",
                        emptyAlert              : "{{.Dictionary.Editor.DialogPreformattedTextEmptyAlert}}",
                        placeholder             : "{{.Dictionary.Editor.DialogPreformattedTextPlaceholder}}",
                    },
                    codeBlock : {
                        title                   : "{{.Dictionary.Editor.DialogCodeBlockTitle}}",
                        selectLabel             : "{{.Dictionary.Editor.DialogCodeBlockSelectLabel}}",
                        selectDefaultText       : "{{.Dictionary.Editor.DialogCodeBlockSelectDefaultText}}",
                        otherLanguage           : "{{.Dictionary.Editor.DialogCodeBlockOtherLanguage}}",
                        unselectedLanguageAlert : "{{.Dictionary.Editor.DialogCodeBlockUnselectedLanguageAlert}}",
                        codeEmptyAlert          : "{{.Dictionary.Editor.DialogCodeBlockCodeEmptyAlert}}",
                        placeholder             : "{{.Dictionary.Editor.DialogCodeBlockPlaceholder}}",
                    },
                    htmlEntities : {
                        title                   : "{{.Dictionary.Editor.DialogHtmlEntitiesTitle}}",
                    },
                    help : {
                        title                   : "{{.Dictionary.Editor.DialogHelpTitle}}",
                    }
                }
            }
        });

        document.getElementById('save-btn').onclick = function() {
            title = document.getElementById('title').value
            save_post('{{.Dto.Id}}', title, editor.getMarkdown(), editor.getHTML());
        }
    });
</script>
